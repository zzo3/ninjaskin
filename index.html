<!DOCTYPE html>
<html lang="zh-Hant">


<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>聊天室浮層 - 專業版</title>
  <style>
@import url('https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;600&display=swap');

html, body {
  margin: 0;
  padding: 0;
  width: 100%;
  height: 100%;
  font-family: 'Noto Sans TC', 'Microsoft JhengHei', 'PingFang TC', sans-serif;
  background: transparent;
  color: #fff;
}

#chat-container {
  position: relative;
  z-index: 1000;
  display: flex;
  flex-direction: column;
  justify-content: flex-end;
  padding: 15px;
  max-width: 400px;
  margin: 0 auto;
  max-height: 100vh;
  overflow-y: auto;
}

/* 訊息容器 */
.message-container {
  position: relative;
  margin-bottom: 40px; /* 預留空間給名稱框 */
  will-change: transform, opacity;
  animation: slideUpFade 0.6s ease-out;
}
.message-container.fadeout {
  animation: fadeOutOnly 10s ease-out forwards;
  animation-delay: 30s;
}
.message-container.fadeout:hover {
  animation-play-state: paused;
  opacity: 1 !important;
  transform: scale(1.03);
  color: #fff !important; /* hover 恢復亮度 */
}

/* 動畫 */
@keyframes slideUpFade {
  from { opacity: 0; transform: translateY(20px); }
  to   { opacity: 1; transform: translateY(0); }
}
@keyframes fadeOutOnly {
  from { opacity: 1; color: #fff; }
  to   { opacity: 0; color: #aaa; }
}

/* 訊息框 */
.message {
  position: relative;
  display: inline-block;
  max-width: 100%;
  background: linear-gradient(135deg, rgba(0,255,255,0.08), rgba(0,0,0,0.2));
  background-clip: padding-box;
  padding: 8px;
  border-radius: 10px;
  color: #fff;
  word-wrap: break-word;
  border: 1px solid #00ffff;
  box-shadow: 0 0 6px #00ffff, 0 0 12px #00ffff;
  font-size: 0.75em;
  text-shadow: 1px 1px 2px #000, 0 0 6px rgba(255,255,255,0.8);
}

/* 名稱框：無背景，字體透明度0.9，邊框透明度0.9 */
.username-box {
  position: absolute;
  bottom: 100%; /* 放在訊息框上方 */
  left: 0;
  margin-bottom: 3px; /* 與訊息框間距 */
  padding: 4px 8px;
  border-radius: 10px;
  font-weight: 600;
  z-index: 2;
  background: transparent;
  font-size: 0.85em;
  text-shadow: 1px 1px 2px #000;
  opacity: 0.9; /* 字體透明度 */
}

/* 平台樣式：邊框顏色透明度0.9 + 光暈 */
.username-box.twitch { border: 2px solid rgba(145,70,255,0.9); color: rgba(145,70,255,0.9); box-shadow: 0 0 6px rgba(145,70,255,0.9); }
.username-box.youtube { border: 2px solid rgba(255,0,0,0.9); color: rgba(255,0,0,0.9); box-shadow: 0 0 6px rgba(255,0,0,0.9); }
.username-box.kick { border: 2px solid rgba(0,255,128,0.9); color: rgba(0,255,128,0.9); box-shadow: 0 0 6px rgba(0,255,128,0.9); }
.username-box.facebook { border: 2px solid rgba(59,89,152,0.9); color: rgba(59,89,152,0.9); box-shadow: 0 0 6px rgba(59,89,152,0.9); }

/* Bot 名稱框：無光暈 */
.username-box.bot { box-shadow: none; }

/* 特別事件：更亮邊框 + 強光暈 */
.username-box.highlight { border-width: 2px; box-shadow: 0 0 10px currentColor, 0 0 20px currentColor; }

.text { line-height: 1.4; word-break: break-word; }
.donation { padding: 5px 10px; color: #ffd700; font-weight: bold; font-size: 0.72em; }
.badge { height: 1em; vertical-align: middle; margin-left: 4px; }
.badges { margin-left: 6px; }
  </style>
</head>



<body>
  <div id="chat-container"></div>

  <!-- 公告管理介面 -->
  <div style="position:fixed; top:10px; right:10px; z-index:2000; background:#222; padding:10px; border-radius:8px; color:#fff; font-size:14px; width:340px;">
    <h3 style="margin:0 0 8px 0;">公告管理</h3>
    
    <!-- 開關公告 -->
    <button onclick="toggleAnnouncement(true)" style="padding:6px 12px; margin-right:5px;">開啟公告</button>
    <button onclick="toggleAnnouncement(false)" style="padding:6px 12px;">關閉公告</button>
    <br><br>

    <!-- 下拉選單推送公告 -->
    <label>選擇公告：</label>
    <select id="announcementSelect" style="width:100%; margin-bottom:8px;"></select>
    <button onclick="sendSelectedAnnouncement()" style="padding:6px 12px; width:100%; margin-bottom:10px;">立即推送</button>

    <!-- 編輯公告 -->
    <label>文字：</label><br>
    <input id="msgText" type="text" style="width:100%;"><br>
    <label>顏色 (Hex)：</label><br>
    <input id="msgColor" type="text" value="#00ffff" style="width:100%;"><br>
    <label>光暈：</label>
    <input id="msgGlow" type="checkbox" checked><br>
    <label>間隔 (毫秒)：</label><br>
    <input id="msgInterval" type="number" value="300000" style="width:100%;"><br><br>

    <!-- 三個平排按鈕 -->
    <div style="display:flex; justify-content:space-between; margin-bottom:10px;">
      <button onclick="addAnnouncement()" style="flex:1; margin-right:5px; padding:6px;">新增</button>
      <button onclick="updateAnnouncement()" style="flex:1; margin-right:5px; padding:6px;">修改</button>
      <button onclick="deleteAnnouncement()" style="flex:1; padding:6px;">刪除</button>
    </div>

    <!-- 公告列表顯示 -->
    <h4 style="margin:10px 0 5px 0;">公告列表</h4>
    <div id="announcementList" style="max-height:220px; overflow-y:auto; background:#333; padding:5px; border-radius:5px;"></div>
  </div>

  <script>
    /* ========= 可調整參數設定區 ========= */
    let scheduledMessages = [
      { text: "歡迎來到直播間！", color: "#00ffff", glow: true, interval: 300000 },
      { text: "記得訂閱和按讚支持～", color: "#ff0000", glow: true, interval: 600000 },
      { text: "加入會員享受更多福利！", color: "#00ff80", glow: false, interval: 900000 }
    ];

    const maxMessages = 50;
    let autoAnnouncement = true;

    function toggleAnnouncement(on) { autoAnnouncement = on; }

    function sendAnnouncementNow(index = 0) {
      if (index < 0 || index >= scheduledMessages.length) index = 0;
      const msg = scheduledMessages[index];
      addMessageToOverlay({
        chatname: "系統公告",
        chatmessage: msg.text,
        type: "bot",
        color: msg.color,
        glow: msg.glow
      });
    }

    function sendSelectedAnnouncement() {
      const idx = document.getElementById("announcementSelect").value;
      sendAnnouncementNow(parseInt(idx));
    }

    function updateAnnouncement() {
      const idx = document.getElementById("announcementSelect").value;
      scheduledMessages[idx] = {
        text: document.getElementById("msgText").value,
        color: document.getElementById("msgColor").value,
        glow: document.getElementById("msgGlow").checked,
        interval: parseInt(document.getElementById("msgInterval").value)
      };
      refreshAnnouncementSelect();
    }

    function addAnnouncement() {
      scheduledMessages.push({
        text: document.getElementById("msgText").value,
        color: document.getElementById("msgColor").value,
        glow: document.getElementById("msgGlow").checked,
        interval: parseInt(document.getElementById("msgInterval").value)
      });
      refreshAnnouncementSelect();
    }

    function deleteAnnouncement() {
      const idx = document.getElementById("announcementSelect").value;
      if (scheduledMessages.length > 0) {
        scheduledMessages.splice(idx, 1);
        refreshAnnouncementSelect();
      }
    }

    function deleteAnnouncementFromList(idx) {
      scheduledMessages.splice(idx, 1);
      refreshAnnouncementSelect();
    }

    function pushAnnouncementFromList(idx) {
      sendAnnouncementNow(idx);
    }

    function refreshAnnouncementSelect() {
      const select = document.getElementById("announcementSelect");
      select.innerHTML = "";
      scheduledMessages.forEach((msg, idx) => {
        const option = document.createElement("option");
        option.value = idx;
        option.text = `${idx+1}. ${msg.text}`;
        select.appendChild(option);
      });
      refreshAnnouncementList();
    }

    function refreshAnnouncementList() {
      const list = document.getElementById("announcementList");
      list.innerHTML = "";
      scheduledMessages.forEach((msg, idx) => {
        const item = document.createElement("div");
        item.style.marginBottom = "8px";
        item.style.padding = "5px";
        item.style.borderBottom = "1px solid #555";
        item.innerHTML = `
          <strong>${idx+1}.</strong> ${msg.text} 
          <br><span style="color:${msg.color};">顏色: ${msg.color}</span> 
          | 光暈: ${msg.glow ? "是" : "否"} 
          | 間隔: ${msg.interval}ms
          <br>
          <button onclick="pushAnnouncementFromList(${idx})" style="margin-top:5px; padding:4px 8px; margin-right:5px;">立即推送</button>
          <button onclick="deleteAnnouncementFromList(${idx})" style="margin-top:5px; padding:4px 8px;">刪除</button>
        `;
        list.appendChild(item);
      });
    }

    /* ========= 聊天訊息顯示邏輯 ========= */
    const chatContainer = document.getElementById('chat-container');

    function addMessageToOverlay(data) {
      if (!data.chatname && data.meta) return;

      const messageContainer = document.createElement('div');
      messageContainer.classList.add('message-container');

      const messageDiv = document.createElement('div');
      messageDiv.classList.add('message');

      messageDiv.innerHTML = `
        <div class="username-box bot">
          <span>${data.chatname || ''}</span>
        </div>
        <div class="text">${data.chatmessage || ''}</div>
      `;

      if (data.type === "bot" && data.chatname === "系統公告") {
        messageDiv.style.borderColor = data.color || "#ffffff";
        messageDiv.style.color = data.color || "#ffffff";
        if (data.glow) {
          messageDiv.style.boxShadow = `0 0 8px ${data.color}, 0 0 16px ${data.color}`;
        }
      }

      messageContainer.appendChild(messageDiv);
      chatContainer.appendChild(messageContainer);

      setTimeout(() => { messageContainer.classList.add('fadeout'); }, 30000);

      while (chatContainer.children.length > maxMessages) {
        chatContainer.removeChild(chatContainer.firstChild);
      }
    }

    document.addEventListener('DOMContentLoaded', () => {
      refreshAnnouncementSelect();

      // 啟動自動公告
      scheduledMessages.forEach((msg, idx) => {
        setInterval(() => {
          if (!autoAnnouncement) return;
          sendAnnouncementNow(idx);
        }, msg.interval);
      });
    });
  </script>
</body>
</html>
